version: '3.4'

services:
  sites:
    build: ./hosthub
    image: luca/HostHub:latest
    restart: always
    depends_on:
      - sql
    volumes:
      -
      -
    hostname: hosthub
    networks: 
      frontend:
        ipv4_address: 10.24.1.10
      backend:
    ports: 
      - "8080:80"

  # gogs:
  #   image: gogs/gogs:latest
  #   restart: always
  #   depends_on: 
  #     - mysql
  #   volumes: 
  #     - ./gogs/data:/data 
  #     - ./gogs:/data/gogs
  #   hostname: gitls
  #   networks:
  #     frontend:
  #       ipv4_address: 10.24.1.11
  #     backend:
  #   ports:  
  #     - "2022:22"
  #     - "8081:3000"

  sql:
    image: luca/sqlhub:latest
    build: ./SQLHub
    restart: always
    volumes: 
      - mariadb:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${ROOT_PSWD}
      - MYSQL_USER=${USR}
      - MYSQL_PASSWORD=${PSWD}
    hostname: sqlhub  
    networks: 
      frontend:

  box:
    image: luca/boxhub:latest
    build: ./BoxHub
    restart: always
    depends_on: 
      - sql
    volumes:
      - 
    hostname: boxhub
    networks: 
      frontend:
        ipv4_address: 10.24.1.21
      backend:
    ports: 
      - "8082:80"

  nginx:
    image: luca/nginx:latest
    build: ./nginx
    depends_on: 
      - apache
      - gogs
      - mysql
      - nextcloud      
    # volumes: 
    #   - ./nginx/conf/:/etc/nginx/
    network_mode: host

  ftp:
    image: luca/ftphub:latest
    build: ./FTPHub
    volumes:
      - 
    hostname: ftphub
    networks: 
      frontend:
        ipv4_address: 10.24.1.32
      backend:
    ports: 
      - 21:21
      - 20:20


volumes:
  mariadb:

networks: 
  backend:
    driver: bridge
  frontend:
    driver: bridge
    ipam:
      config:
        - subnet: 10.24.1.0/26
